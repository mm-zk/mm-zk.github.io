import{j as x,Y as J,ag as xe,K as j,ah as ne,ai as Oe,H as D,M as ue,g as W,aj as Se,G as _,I as re,J as le,L as Y,F as Ie,N as G,P as de,O as B,ak as ye}from"./Dk_43wzT.js";import{o as te,f as Re,u as Ee,t as ie}from"./amTdRpMH.js";import{c as N,o as S,w as Ce,t as we,i as Q,E as Te,A as q,T as oe,I as Z,U as Me,N as X,l as ze,O as Pe,e as A,V as De}from"./yhpzh7P7.js";import{c as z,f as ae,s as $e,i as Ae,u as Fe}from"./Bvgi-ftF.js";function H(l,s,e){let n=e.initialDeps??[],t;return()=>{var a,i,o,d;let f;e.key&&((a=e.debug)!=null&&a.call(e))&&(f=Date.now());const p=l();if(!(p.length!==n.length||p.some((M,E)=>n[E]!==M)))return t;n=p;let R;if(e.key&&((i=e.debug)!=null&&i.call(e))&&(R=Date.now()),t=s(...p),e.key&&((o=e.debug)!=null&&o.call(e))){const M=Math.round((Date.now()-f)*100)/100,E=Math.round((Date.now()-R)*100)/100,$=E/16,F=(P,b)=>{for(P=String(P);P.length<b;)P=" "+P;return P};console.info(`%c⏱ ${F(E,5)} /${F(M,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*$,120))}deg 100% 31%);`,e==null?void 0:e.key)}return(d=e==null?void 0:e.onChange)==null||d.call(e,t),t}}function ee(l,s){if(l===void 0)throw new Error("Unexpected undefined");return l}const Ve=(l,s)=>Math.abs(l-s)<1,ke=(l,s,e)=>{let n;return function(...t){l.clearTimeout(n),n=l.setTimeout(()=>s.apply(this,t),e)}},_e=l=>l,Be=l=>{const s=Math.max(l.startIndex-l.overscan,0),e=Math.min(l.endIndex+l.overscan,l.count-1),n=[];for(let t=s;t<=e;t++)n.push(t);return n},je=(l,s)=>{const e=l.scrollElement;if(!e)return;const n=l.targetWindow;if(!n)return;const t=i=>{const{width:o,height:d}=i;s({width:Math.round(o),height:Math.round(d)})};if(t(e.getBoundingClientRect()),!n.ResizeObserver)return()=>{};const a=new n.ResizeObserver(i=>{const o=i[0];if(o!=null&&o.borderBoxSize){const d=o.borderBoxSize[0];if(d){t({width:d.inlineSize,height:d.blockSize});return}}t(e.getBoundingClientRect())});return a.observe(e,{box:"border-box"}),()=>{a.unobserve(e)}},se={passive:!0},Le=typeof window>"u"?!0:"onscrollend"in window,Ne=(l,s)=>{const e=l.scrollElement;if(!e)return;const n=l.targetWindow;if(!n)return;let t=0;const a=Le?()=>{}:ke(n,()=>{s(t,!1)},l.options.isScrollingResetDelay),i=f=>()=>{t=e[l.options.horizontal?"scrollLeft":"scrollTop"],a(),s(t,f)},o=i(!0),d=i(!1);return d(),e.addEventListener("scroll",o,se),e.addEventListener("scrollend",d,se),()=>{e.removeEventListener("scroll",o),e.removeEventListener("scrollend",d)}},We=(l,s,e)=>{if(s!=null&&s.borderBoxSize){const n=s.borderBoxSize[0];if(n)return Math.round(n[e.options.horizontal?"inlineSize":"blockSize"])}return Math.round(l.getBoundingClientRect()[e.options.horizontal?"width":"height"])},Ke=(l,{adjustments:s=0,behavior:e},n)=>{var t,a;const i=l+s;(a=(t=n.scrollElement)==null?void 0:t.scrollTo)==null||a.call(t,{[n.options.horizontal?"left":"top"]:i,behavior:e})};class Ue{constructor(s){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.scrollToIndexTimeoutId=null,this.measurementsCache=[],this.itemSizeCache=new Map,this.pendingMeasuredCacheIndexes=[],this.scrollDirection=null,this.scrollAdjustments=0,this.measureElementCache=new Map,this.observer=(()=>{let e=null;const n=()=>e||(!this.targetWindow||!this.targetWindow.ResizeObserver?null:e=new this.targetWindow.ResizeObserver(t=>{t.forEach(a=>{this._measureElement(a.target,a)})}));return{disconnect:()=>{var t;return(t=n())==null?void 0:t.disconnect()},observe:t=>{var a;return(a=n())==null?void 0:a.observe(t,{box:"border-box"})},unobserve:t=>{var a;return(a=n())==null?void 0:a.unobserve(t)}}})(),this.range=null,this.setOptions=e=>{Object.entries(e).forEach(([n,t])=>{typeof t>"u"&&delete e[n]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:_e,rangeExtractor:Be,onChange:()=>{},measureElement:We,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,...e}},this.notify=(e,n)=>{var t,a;const{startIndex:i,endIndex:o}=this.range??{startIndex:void 0,endIndex:void 0},d=this.calculateRange();(e||i!==(d==null?void 0:d.startIndex)||o!==(d==null?void 0:d.endIndex))&&((a=(t=this.options).onChange)==null||a.call(t,this,n))},this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(e=>e()),this.unsubs=[],this.scrollElement=null},this._didMount=()=>(this.measureElementCache.forEach(this.observer.observe),()=>{this.observer.disconnect(),this.cleanup()}),this._willUpdate=()=>{var e;const n=this.options.getScrollElement();this.scrollElement!==n&&(this.cleanup(),this.scrollElement=n,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=((e=this.scrollElement)==null?void 0:e.window)??null,this._scrollToOffset(this.scrollOffset,{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,t=>{this.scrollRect=t,this.notify(!1,!1)})),this.unsubs.push(this.options.observeElementOffset(this,(t,a)=>{this.scrollAdjustments=0,this.scrollDirection=a?this.scrollOffset<t?"forward":"backward":null,this.scrollOffset=t;const i=this.isScrolling;this.isScrolling=a,this.notify(i!==a,a)})))},this.getSize=()=>this.scrollRect[this.options.horizontal?"width":"height"],this.getMeasurementOptions=H(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey],(e,n,t,a)=>(this.pendingMeasuredCacheIndexes=[],{count:e,paddingStart:n,scrollMargin:t,getItemKey:a}),{key:!1}),this.getFurthestMeasurement=(e,n)=>{const t=new Map,a=new Map;for(let i=n-1;i>=0;i--){const o=e[i];if(t.has(o.lane))continue;const d=a.get(o.lane);if(d==null||o.end>d.end?a.set(o.lane,o):o.end<d.end&&t.set(o.lane,!0),t.size===this.options.lanes)break}return a.size===this.options.lanes?Array.from(a.values()).sort((i,o)=>i.end===o.end?i.index-o.index:i.end-o.end)[0]:void 0},this.getMeasurements=H(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:e,paddingStart:n,scrollMargin:t,getItemKey:a},i)=>{const o=this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[];const d=this.measurementsCache.slice(0,o);for(let f=o;f<e;f++){const p=a(f),h=this.options.lanes===1?d[f-1]:this.getFurthestMeasurement(d,f),R=h?h.end+this.options.gap:n+t,M=i.get(p),E=typeof M=="number"?M:this.options.estimateSize(f),$=R+E,F=h?h.lane:f%this.options.lanes;d[f]={index:f,start:R,size:E,end:$,key:p,lane:F}}return this.measurementsCache=d,d},{key:!1,debug:()=>this.options.debug}),this.calculateRange=H(()=>[this.getMeasurements(),this.getSize(),this.scrollOffset],(e,n,t)=>this.range=e.length>0&&n>0?He({measurements:e,outerSize:n,scrollOffset:t}):null,{key:!1,debug:()=>this.options.debug}),this.getIndexes=H(()=>[this.options.rangeExtractor,this.calculateRange(),this.options.overscan,this.options.count],(e,n,t,a)=>n===null?[]:e({startIndex:n.startIndex,endIndex:n.endIndex,overscan:t,count:a}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=e=>{const n=this.options.indexAttribute,t=e.getAttribute(n);return t?parseInt(t,10):(console.warn(`Missing attribute name '${n}={index}' on measured element.`),-1)},this._measureElement=(e,n)=>{const t=this.measurementsCache[this.indexFromElement(e)];if(!t||!e.isConnected){this.measureElementCache.forEach((o,d)=>{o===e&&(this.observer.unobserve(e),this.measureElementCache.delete(d))});return}const a=this.measureElementCache.get(t.key);a!==e&&(a&&this.observer.unobserve(a),this.observer.observe(e),this.measureElementCache.set(t.key,e));const i=this.options.measureElement(e,n,this);this.resizeItem(t,i)},this.resizeItem=(e,n)=>{const t=this.itemSizeCache.get(e.key)??e.size,a=n-t;a!==0&&((this.shouldAdjustScrollPositionOnItemSizeChange!==void 0?this.shouldAdjustScrollPositionOnItemSizeChange(e,a,this):e.start<this.scrollOffset+this.scrollAdjustments)&&this._scrollToOffset(this.scrollOffset,{adjustments:this.scrollAdjustments+=a,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(e.index),this.itemSizeCache=new Map(this.itemSizeCache.set(e.key,n)),this.notify(!0,!1))},this.measureElement=e=>{e&&this._measureElement(e,void 0)},this.getVirtualItems=H(()=>[this.getIndexes(),this.getMeasurements()],(e,n)=>{const t=[];for(let a=0,i=e.length;a<i;a++){const o=e[a],d=n[o];t.push(d)}return t},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=e=>{const n=this.getMeasurements();return ee(n[ce(0,n.length-1,t=>ee(n[t]).start,e)])},this.getOffsetForAlignment=(e,n)=>{const t=this.getSize();n==="auto"&&(e<=this.scrollOffset?n="start":e>=this.scrollOffset+t?n="end":n="start"),n==="start"?e=e:n==="end"?e=e-t:n==="center"&&(e=e-t/2);const a=this.options.horizontal?"scrollWidth":"scrollHeight",o=(this.scrollElement?"document"in this.scrollElement?this.scrollElement.document.documentElement[a]:this.scrollElement[a]:0)-this.getSize();return Math.max(Math.min(o,e),0)},this.getOffsetForIndex=(e,n="auto")=>{e=Math.max(0,Math.min(e,this.options.count-1));const t=ee(this.getMeasurements()[e]);if(n==="auto")if(t.end>=this.scrollOffset+this.getSize()-this.options.scrollPaddingEnd)n="end";else if(t.start<=this.scrollOffset+this.options.scrollPaddingStart)n="start";else return[this.scrollOffset,n];const a=n==="end"?t.end+this.options.scrollPaddingEnd:t.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(a,n),n]},this.isDynamicMode=()=>this.measureElementCache.size>0,this.cancelScrollToIndex=()=>{this.scrollToIndexTimeoutId!==null&&this.targetWindow&&(this.targetWindow.clearTimeout(this.scrollToIndexTimeoutId),this.scrollToIndexTimeoutId=null)},this.scrollToOffset=(e,{align:n="start",behavior:t}={})=>{this.cancelScrollToIndex(),t==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(e,n),{adjustments:void 0,behavior:t})},this.scrollToIndex=(e,{align:n="auto",behavior:t}={})=>{e=Math.max(0,Math.min(e,this.options.count-1)),this.cancelScrollToIndex(),t==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size.");const[a,i]=this.getOffsetForIndex(e,n);this._scrollToOffset(a,{adjustments:void 0,behavior:t}),t!=="smooth"&&this.isDynamicMode()&&this.targetWindow&&(this.scrollToIndexTimeoutId=this.targetWindow.setTimeout(()=>{if(this.scrollToIndexTimeoutId=null,this.measureElementCache.has(this.options.getItemKey(e))){const[d]=this.getOffsetForIndex(e,i);Ve(d,this.scrollOffset)||this.scrollToIndex(e,{align:i,behavior:t})}else this.scrollToIndex(e,{align:i,behavior:t})}))},this.scrollBy=(e,{behavior:n}={})=>{this.cancelScrollToIndex(),n==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.scrollOffset+e,{adjustments:void 0,behavior:n})},this.getTotalSize=()=>{var e;const n=this.getMeasurements();let t;return n.length===0?t=this.options.paddingStart:t=this.options.lanes===1?((e=n[n.length-1])==null?void 0:e.end)??0:Math.max(...n.slice(-this.options.lanes).map(a=>a.end)),t-this.options.scrollMargin+this.options.paddingEnd},this._scrollToOffset=(e,{adjustments:n,behavior:t})=>{this.options.scrollToFn(e,{behavior:t,adjustments:n},this)},this.measure=()=>{var e,n;this.itemSizeCache=new Map,(n=(e=this.options).onChange)==null||n.call(e,this,!1)},this.setOptions(s),this.scrollRect=this.options.initialRect,this.scrollOffset=typeof this.options.initialOffset=="function"?this.options.initialOffset():this.options.initialOffset,this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(e=>{this.itemSizeCache.set(e.key,e.size)}),this.notify(!1,!1)}}const ce=(l,s,e,n)=>{for(;l<=s;){const t=(l+s)/2|0,a=e(t);if(a<n)l=t+1;else if(a>n)s=t-1;else return t}return l>0?l-1:0};function He({measurements:l,outerSize:s,scrollOffset:e}){const n=l.length-1,a=ce(0,n,o=>l[o].start,e);let i=a;for(;i<n&&l[i].end<e+s;)i++;return{startIndex:a,endIndex:i}}function qe(l){const s=new Ue(J(l)),e=xe(s),n=s._didMount();return j(()=>J(l).getScrollElement(),t=>{t&&s._willUpdate()},{immediate:!0}),j(()=>J(l),t=>{s.setOptions({...t,onChange:(a,i)=>{var o;ne(e),(o=t.onChange)==null||o.call(t,a,i)}}),s._willUpdate(),ne(e)},{immediate:!0}),Oe(n),e}function Je(l){return qe(x(()=>({observeElementRect:je,observeElementOffset:Ne,scrollToFn:Ke,...J(l)})))}function Ye(l,s,e){let n=D(e==null?void 0:e.value),t=x(()=>l.value!==void 0);return[x(()=>t.value?l.value:n.value),function(a){return t.value||(n.value=a),s==null?void 0:s(a)}]}function Ge(){let l=te();return ue(()=>l.dispose()),l}function Qe(){let l=Ge();return s=>{l.dispose(),l.nextFrame(s)}}var ve=(l=>(l[l.Left=0]="Left",l[l.Right=2]="Right",l))(ve||{});function fe(l={},s=null,e=[]){for(let[n,t]of Object.entries(l))he(e,pe(s,n),t);return e}function pe(l,s){return l?l+"["+s+"]":s}function he(l,s,e){if(Array.isArray(e))for(let[n,t]of e.entries())he(l,pe(s,n.toString()),t);else e instanceof Date?l.push([s,e.toISOString()]):typeof e=="boolean"?l.push([s,e?"1":"0"]):typeof e=="string"?l.push([s,e]):typeof e=="number"?l.push([s,`${e}`]):e==null?l.push([s,""]):fe(e,s,l)}var Xe={};function Ze(l,s){return l===s}var et=(l=>(l[l.Open=0]="Open",l[l.Closed=1]="Closed",l))(et||{}),tt=(l=>(l[l.Single=0]="Single",l[l.Multi=1]="Multi",l))(tt||{}),lt=(l=>(l[l.Pointer=0]="Pointer",l[l.Focus=1]="Focus",l[l.Other=2]="Other",l))(lt||{});let me=Symbol("ComboboxContext");function K(l){let s=de(me,null);if(s===null){let e=new Error(`<${l} /> is missing a parent <Combobox /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(e,K),e}return s}let be=Symbol("VirtualContext"),ot=W({name:"VirtualProvider",setup(l,{slots:s}){let e=K("VirtualProvider"),n=x(()=>{let o=S(e.optionsRef);if(!o)return{start:0,end:0};let d=window.getComputedStyle(o);return{start:parseFloat(d.paddingBlockStart||d.paddingTop),end:parseFloat(d.paddingBlockEnd||d.paddingBottom)}}),t=Je(x(()=>({scrollPaddingStart:n.value.start,scrollPaddingEnd:n.value.end,count:e.virtual.value.options.length,estimateSize(){return 40},getScrollElement(){return S(e.optionsRef)},overscan:12}))),a=x(()=>{var o;return(o=e.virtual.value)==null?void 0:o.options}),i=D(0);return j([a],()=>{i.value+=1}),re(be,e.virtual.value?t:null),()=>[Y("div",{style:{position:"relative",width:"100%",height:`${t.value.getTotalSize()}px`},ref:o=>{if(o){if(typeof process<"u"&&Xe.JEST_WORKER_ID!==void 0||e.activationTrigger.value===0)return;e.activeOptionIndex.value!==null&&e.virtual.value.options.length>e.activeOptionIndex.value&&t.value.scrollToIndex(e.activeOptionIndex.value)}}},t.value.getVirtualItems().map(o=>ye(s.default({option:e.virtual.value.options[o.index],open:e.comboboxState.value===0})[0],{key:`${i.value}-${o.index}`,"data-index":o.index,"aria-setsize":e.virtual.value.options.length,"aria-posinset":o.index+1,style:{position:"absolute",top:0,left:0,transform:`translateY(${o.start}px)`,overflowAnchor:"none"}})))]}}),ut=W({name:"Combobox",emits:{"update:modelValue":l=>!0},props:{as:{type:[Object,String],default:"template"},disabled:{type:[Boolean],default:!1},by:{type:[String,Function],nullable:!0,default:null},modelValue:{type:[Object,String,Number,Boolean],default:void 0},defaultValue:{type:[Object,String,Number,Boolean],default:void 0},form:{type:String,optional:!0},name:{type:String,optional:!0},nullable:{type:Boolean,default:!1},multiple:{type:[Boolean],default:!1},immediate:{type:[Boolean],default:!1},virtual:{type:Object,default:null}},inheritAttrs:!1,setup(l,{slots:s,attrs:e,emit:n}){let t=D(1),a=D(null),i=D(null),o=D(null),d=D(null),f=D({static:!1,hold:!1}),p=D([]),h=D(null),R=D(2),M=D(!1);function E(u=c=>c){let c=h.value!==null?p.value[h.value]:null,m=u(p.value.slice()),g=m.length>0&&m[0].dataRef.order.value!==null?m.sort((T,k)=>T.dataRef.order.value-k.dataRef.order.value):Pe(m,T=>S(T.dataRef.domRef)),w=c?g.indexOf(c):null;return w===-1&&(w=null),{options:g,activeOptionIndex:w}}let $=x(()=>l.multiple?1:0),F=x(()=>l.nullable),[P,b]=Ye(x(()=>l.modelValue),u=>n("update:modelValue",u),x(()=>l.defaultValue)),C=x(()=>P.value===void 0?N($.value,{1:[],0:void 0}):P.value),V=null,v=null;function I(u){return N($.value,{0(){return b==null?void 0:b(u)},1:()=>{let c=_(r.value.value).slice(),m=_(u),g=c.findIndex(w=>r.compare(m,_(w)));return g===-1?c.push(m):c.splice(g,1),b==null?void 0:b(c)}})}let y=x(()=>{});j([y],([u],[c])=>{if(r.virtual.value&&u&&c&&h.value!==null){let m=u.indexOf(c[h.value]);m!==-1?h.value=m:h.value=null}});let r={comboboxState:t,value:C,mode:$,compare(u,c){if(typeof l.by=="string"){let m=l.by;return(u==null?void 0:u[m])===(c==null?void 0:c[m])}return l.by===null?Ze(u,c):l.by(u,c)},calculateIndex(u){return r.virtual.value?l.by===null?r.virtual.value.options.indexOf(u):r.virtual.value.options.findIndex(c=>r.compare(c,u)):p.value.findIndex(c=>r.compare(c.dataRef.value,u))},defaultValue:x(()=>l.defaultValue),nullable:F,immediate:x(()=>!1),virtual:x(()=>null),inputRef:i,labelRef:a,buttonRef:o,optionsRef:d,disabled:x(()=>l.disabled),options:p,change(u){b(u)},activeOptionIndex:x(()=>{if(M.value&&h.value===null&&(r.virtual.value?r.virtual.value.options.length>0:p.value.length>0)){if(r.virtual.value){let c=r.virtual.value.options.findIndex(m=>{var g;return!((g=r.virtual.value)!=null&&g.disabled(m))});if(c!==-1)return c}let u=p.value.findIndex(c=>!c.dataRef.disabled);if(u!==-1)return u}return h.value}),activationTrigger:R,optionsPropsRef:f,closeCombobox(){M.value=!1,!l.disabled&&t.value!==1&&(t.value=1,h.value=null)},openCombobox(){if(M.value=!0,!l.disabled&&t.value!==0){if(r.value.value){let u=r.calculateIndex(r.value.value);u!==-1&&(h.value=u)}t.value=0}},setActivationTrigger(u){R.value=u},goToOption(u,c,m){M.value=!1,V!==null&&cancelAnimationFrame(V),V=requestAnimationFrame(()=>{if(l.disabled||d.value&&!f.value.static&&t.value===1)return;if(r.virtual.value){h.value=u===z.Specific?c:ae({focus:u},{resolveItems:()=>r.virtual.value.options,resolveActiveIndex:()=>{var T,k;return(k=(T=r.activeOptionIndex.value)!=null?T:r.virtual.value.options.findIndex(L=>{var U;return!((U=r.virtual.value)!=null&&U.disabled(L))}))!=null?k:null},resolveDisabled:T=>r.virtual.value.disabled(T),resolveId(){throw new Error("Function not implemented.")}}),R.value=m??2;return}let g=E();if(g.activeOptionIndex===null){let T=g.options.findIndex(k=>!k.dataRef.disabled);T!==-1&&(g.activeOptionIndex=T)}let w=u===z.Specific?c:ae({focus:u},{resolveItems:()=>g.options,resolveActiveIndex:()=>g.activeOptionIndex,resolveId:T=>T.id,resolveDisabled:T=>T.dataRef.disabled});h.value=w,R.value=m??2,p.value=g.options})},selectOption(u){let c=p.value.find(g=>g.id===u);if(!c)return;let{dataRef:m}=c;I(m.value)},selectActiveOption(){if(r.activeOptionIndex.value!==null){if(r.virtual.value)I(r.virtual.value.options[r.activeOptionIndex.value]);else{let{dataRef:u}=p.value[r.activeOptionIndex.value];I(u.value)}r.goToOption(z.Specific,r.activeOptionIndex.value)}},registerOption(u,c){let m=Se({id:u,dataRef:c});if(r.virtual.value){p.value.push(m);return}v&&cancelAnimationFrame(v);let g=E(w=>(w.push(m),w));h.value===null&&r.isSelected(c.value.value)&&(g.activeOptionIndex=g.options.indexOf(m)),p.value=g.options,h.value=g.activeOptionIndex,R.value=2,g.options.some(w=>!S(w.dataRef.domRef))&&(v=requestAnimationFrame(()=>{let w=E();p.value=w.options,h.value=w.activeOptionIndex}))},unregisterOption(u,c){if(V!==null&&cancelAnimationFrame(V),c&&(M.value=!0),r.virtual.value){p.value=p.value.filter(g=>g.id!==u);return}let m=E(g=>{let w=g.findIndex(T=>T.id===u);return w!==-1&&g.splice(w,1),g});p.value=m.options,h.value=m.activeOptionIndex,R.value=2},isSelected(u){return N($.value,{0:()=>r.compare(_(r.value.value),_(u)),1:()=>_(r.value.value).some(c=>r.compare(_(c),_(u)))})},isActive(u){return h.value===r.calculateIndex(u)}};Ce([i,o,d],()=>r.closeCombobox(),x(()=>t.value===0)),re(me,r),we(x(()=>N(t.value,{0:Q.Open,1:Q.Closed})));let O=x(()=>{var u;return(u=S(i))==null?void 0:u.closest("form")});return le(()=>{j([O],()=>{if(!O.value||l.defaultValue===void 0)return;function u(){r.change(l.defaultValue)}return O.value.addEventListener("reset",u),()=>{var c;(c=O.value)==null||c.removeEventListener("reset",u)}},{immediate:!0})}),()=>{var u,c,m;let{name:g,disabled:w,form:T,...k}=l,L={open:t.value===0,disabled:w,activeIndex:r.activeOptionIndex.value,activeOption:r.activeOptionIndex.value===null?null:r.virtual.value?r.virtual.value.options[(u=r.activeOptionIndex.value)!=null?u:0]:(m=(c=r.options.value[r.activeOptionIndex.value])==null?void 0:c.dataRef.value)!=null?m:null,value:C.value};return Y(Ie,[...g!=null&&C.value!=null?fe({[g]:C.value}).map(([U,ge])=>Y(Re,Te({features:Ee.Hidden,key:U,as:"input",type:"hidden",hidden:!0,readOnly:!0,form:T,disabled:w,name:U,value:ge}))):[],q({theirProps:{...e,...oe(k,["by","defaultValue","immediate","modelValue","multiple","nullable","onUpdate:modelValue","virtual"])},ourProps:{},slot:L,slots:s,attrs:e,name:"Combobox"})])}}}),rt=W({name:"ComboboxButton",props:{as:{type:[Object,String],default:"button"},id:{type:String,default:null}},setup(l,{attrs:s,slots:e,expose:n}){var t;let a=(t=l.id)!=null?t:`headlessui-combobox-button-${Z()}`,i=K("ComboboxButton");n({el:i.buttonRef,$el:i.buttonRef});function o(p){i.disabled.value||(i.comboboxState.value===0?i.closeCombobox():(p.preventDefault(),i.openCombobox()),B(()=>{var h;return(h=S(i.inputRef))==null?void 0:h.focus({preventScroll:!0})}))}function d(p){switch(p.key){case A.ArrowDown:p.preventDefault(),p.stopPropagation(),i.comboboxState.value===1&&i.openCombobox(),B(()=>{var h;return(h=i.inputRef.value)==null?void 0:h.focus({preventScroll:!0})});return;case A.ArrowUp:p.preventDefault(),p.stopPropagation(),i.comboboxState.value===1&&(i.openCombobox(),B(()=>{i.value.value||i.goToOption(z.Last)})),B(()=>{var h;return(h=i.inputRef.value)==null?void 0:h.focus({preventScroll:!0})});return;case A.Escape:if(i.comboboxState.value!==0)return;p.preventDefault(),i.optionsRef.value&&!i.optionsPropsRef.value.static&&p.stopPropagation(),i.closeCombobox(),B(()=>{var h;return(h=i.inputRef.value)==null?void 0:h.focus({preventScroll:!0})});return}}let f=$e(x(()=>({as:l.as,type:s.type})),i.buttonRef);return()=>{var p,h;let R={open:i.comboboxState.value===0,disabled:i.disabled.value,value:i.value.value},{...M}=l,E={ref:i.buttonRef,id:a,type:f.value,tabindex:"-1","aria-haspopup":"listbox","aria-controls":(p=S(i.optionsRef))==null?void 0:p.id,"aria-expanded":i.comboboxState.value===0,"aria-labelledby":i.labelRef.value?[(h=S(i.labelRef))==null?void 0:h.id,a].join(" "):void 0,disabled:i.disabled.value===!0?!0:void 0,onKeydown:d,onClick:o};return q({ourProps:E,theirProps:M,slot:R,attrs:s,slots:e,name:"ComboboxButton"})}}}),dt=W({name:"ComboboxInput",props:{as:{type:[Object,String],default:"input"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},displayValue:{type:Function},defaultValue:{type:String,default:void 0},id:{type:String,default:null}},emits:{change:l=>!0},setup(l,{emit:s,attrs:e,slots:n,expose:t}){var a;let i=(a=l.id)!=null?a:`headlessui-combobox-input-${Z()}`,o=K("ComboboxInput"),d=x(()=>Me(S(o.inputRef))),f={value:!1};t({el:o.inputRef,$el:o.inputRef});function p(){o.change(null);let v=S(o.optionsRef);v&&(v.scrollTop=0),o.goToOption(z.Nothing)}let h=x(()=>{var v;let I=o.value.value;return S(o.inputRef)?typeof l.displayValue<"u"&&I!==void 0?(v=l.displayValue(I))!=null?v:"":typeof I=="string"?I:"":""});le(()=>{j([h,o.comboboxState,d],([v,I],[y,r])=>{if(f.value)return;let O=S(o.inputRef);O&&((r===0&&I===1||v!==y)&&(O.value=v),requestAnimationFrame(()=>{var u;if(f.value||!O||((u=d.value)==null?void 0:u.activeElement)!==O)return;let{selectionStart:c,selectionEnd:m}=O;Math.abs((m??0)-(c??0))===0&&c===0&&O.setSelectionRange(O.value.length,O.value.length)}))},{immediate:!0}),j([o.comboboxState],([v],[I])=>{if(v===0&&I===1){if(f.value)return;let y=S(o.inputRef);if(!y)return;let r=y.value,{selectionStart:O,selectionEnd:u,selectionDirection:c}=y;y.value="",y.value=r,c!==null?y.setSelectionRange(O,u,c):y.setSelectionRange(O,u)}})});let R=D(!1);function M(){R.value=!0}function E(){te().nextFrame(()=>{R.value=!1})}let $=Qe();function F(v){switch(f.value=!0,$(()=>{f.value=!1}),v.key){case A.Enter:if(f.value=!1,o.comboboxState.value!==0||R.value)return;if(v.preventDefault(),v.stopPropagation(),o.activeOptionIndex.value===null){o.closeCombobox();return}o.selectActiveOption(),o.mode.value===0&&o.closeCombobox();break;case A.ArrowDown:return f.value=!1,v.preventDefault(),v.stopPropagation(),N(o.comboboxState.value,{0:()=>o.goToOption(z.Next),1:()=>o.openCombobox()});case A.ArrowUp:return f.value=!1,v.preventDefault(),v.stopPropagation(),N(o.comboboxState.value,{0:()=>o.goToOption(z.Previous),1:()=>{o.openCombobox(),B(()=>{o.value.value||o.goToOption(z.Last)})}});case A.Home:if(v.shiftKey)break;return f.value=!1,v.preventDefault(),v.stopPropagation(),o.goToOption(z.First);case A.PageUp:return f.value=!1,v.preventDefault(),v.stopPropagation(),o.goToOption(z.First);case A.End:if(v.shiftKey)break;return f.value=!1,v.preventDefault(),v.stopPropagation(),o.goToOption(z.Last);case A.PageDown:return f.value=!1,v.preventDefault(),v.stopPropagation(),o.goToOption(z.Last);case A.Escape:if(f.value=!1,o.comboboxState.value!==0)return;v.preventDefault(),o.optionsRef.value&&!o.optionsPropsRef.value.static&&v.stopPropagation(),o.nullable.value&&o.mode.value===0&&o.value.value===null&&p(),o.closeCombobox();break;case A.Tab:if(f.value=!1,o.comboboxState.value!==0)return;o.mode.value===0&&o.activationTrigger.value!==1&&o.selectActiveOption(),o.closeCombobox();break}}function P(v){s("change",v),o.nullable.value&&o.mode.value===0&&v.target.value===""&&p(),o.openCombobox()}function b(v){var I,y,r;let O=(I=v.relatedTarget)!=null?I:ie.find(u=>u!==v.currentTarget);if(f.value=!1,!((y=S(o.optionsRef))!=null&&y.contains(O))&&!((r=S(o.buttonRef))!=null&&r.contains(O))&&o.comboboxState.value===0)return v.preventDefault(),o.mode.value===0&&(o.nullable.value&&o.value.value===null?p():o.activationTrigger.value!==1&&o.selectActiveOption()),o.closeCombobox()}function C(v){var I,y,r;let O=(I=v.relatedTarget)!=null?I:ie.find(u=>u!==v.currentTarget);(y=S(o.buttonRef))!=null&&y.contains(O)||(r=S(o.optionsRef))!=null&&r.contains(O)||o.disabled.value||o.immediate.value&&o.comboboxState.value!==0&&(o.openCombobox(),te().nextFrame(()=>{o.setActivationTrigger(1)}))}let V=x(()=>{var v,I,y,r;return(r=(y=(I=l.defaultValue)!=null?I:o.defaultValue.value!==void 0?(v=l.displayValue)==null?void 0:v.call(l,o.defaultValue.value):null)!=null?y:o.defaultValue.value)!=null?r:""});return()=>{var v,I,y,r,O,u,c;let m={open:o.comboboxState.value===0},{displayValue:g,onChange:w,...T}=l,k={"aria-controls":(v=o.optionsRef.value)==null?void 0:v.id,"aria-expanded":o.comboboxState.value===0,"aria-activedescendant":o.activeOptionIndex.value===null?void 0:o.virtual.value?(I=o.options.value.find(L=>!o.virtual.value.disabled(L.dataRef.value)&&o.compare(L.dataRef.value,o.virtual.value.options[o.activeOptionIndex.value])))==null?void 0:I.id:(y=o.options.value[o.activeOptionIndex.value])==null?void 0:y.id,"aria-labelledby":(u=(r=S(o.labelRef))==null?void 0:r.id)!=null?u:(O=S(o.buttonRef))==null?void 0:O.id,"aria-autocomplete":"list",id:i,onCompositionstart:M,onCompositionend:E,onKeydown:F,onInput:P,onFocus:C,onBlur:b,role:"combobox",type:(c=e.type)!=null?c:"text",tabIndex:0,ref:o.inputRef,defaultValue:V.value,disabled:o.disabled.value===!0?!0:void 0};return q({ourProps:k,theirProps:T,slot:m,attrs:e,slots:n,features:X.RenderStrategy|X.Static,name:"ComboboxInput"})}}}),ct=W({name:"ComboboxOptions",props:{as:{type:[Object,String],default:"ul"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},hold:{type:[Boolean],default:!1}},setup(l,{attrs:s,slots:e,expose:n}){let t=K("ComboboxOptions"),a=`headlessui-combobox-options-${Z()}`;n({el:t.optionsRef,$el:t.optionsRef}),G(()=>{t.optionsPropsRef.value.static=l.static}),G(()=>{t.optionsPropsRef.value.hold=l.hold});let i=ze(),o=x(()=>i!==null?(i.value&Q.Open)===Q.Open:t.comboboxState.value===0);Ae({container:x(()=>S(t.optionsRef)),enabled:x(()=>t.comboboxState.value===0),accept(f){return f.getAttribute("role")==="option"?NodeFilter.FILTER_REJECT:f.hasAttribute("role")?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT},walk(f){f.setAttribute("role","none")}});function d(f){f.preventDefault()}return()=>{var f,p,h;let R={open:t.comboboxState.value===0},M={"aria-labelledby":(h=(f=S(t.labelRef))==null?void 0:f.id)!=null?h:(p=S(t.buttonRef))==null?void 0:p.id,id:a,ref:t.optionsRef,role:"listbox","aria-multiselectable":t.mode.value===1?!0:void 0,onMousedown:d},E=oe(l,["hold"]);return q({ourProps:M,theirProps:E,slot:R,attrs:s,slots:t.virtual.value&&t.comboboxState.value===0?{...e,default:()=>[Y(ot,{},e.default)]}:e,features:X.RenderStrategy|X.Static,visible:o.value,name:"ComboboxOptions"})}}}),vt=W({name:"ComboboxOption",props:{as:{type:[Object,String],default:"li"},value:{type:[Object,String,Number,Boolean]},disabled:{type:Boolean,default:!1},order:{type:[Number],default:null}},setup(l,{slots:s,attrs:e,expose:n}){let t=K("ComboboxOption"),a=`headlessui-combobox-option-${Z()}`,i=D(null),o=x(()=>l.disabled);n({el:i,$el:i});let d=x(()=>{var b;return t.virtual.value?t.activeOptionIndex.value===t.calculateIndex(l.value):t.activeOptionIndex.value===null?!1:((b=t.options.value[t.activeOptionIndex.value])==null?void 0:b.id)===a}),f=x(()=>t.isSelected(l.value)),p=de(be,null),h=x(()=>({disabled:l.disabled,value:l.value,domRef:i,order:x(()=>l.order)}));le(()=>t.registerOption(a,h)),ue(()=>t.unregisterOption(a,d.value)),G(()=>{let b=S(i);b&&(p==null||p.value.measureElement(b))}),G(()=>{t.comboboxState.value===0&&d.value&&(t.virtual.value||t.activationTrigger.value!==0&&B(()=>{var b,C;return(C=(b=S(i))==null?void 0:b.scrollIntoView)==null?void 0:C.call(b,{block:"nearest"})}))});function R(b){b.preventDefault(),b.button===ve.Left&&(o.value||(t.selectOption(a),De()||requestAnimationFrame(()=>{var C;return(C=S(t.inputRef))==null?void 0:C.focus({preventScroll:!0})}),t.mode.value===0&&t.closeCombobox()))}function M(){var b;if(l.disabled||(b=t.virtual.value)!=null&&b.disabled(l.value))return t.goToOption(z.Nothing);let C=t.calculateIndex(l.value);t.goToOption(z.Specific,C)}let E=Fe();function $(b){E.update(b)}function F(b){var C;if(!E.wasMoved(b)||l.disabled||(C=t.virtual.value)!=null&&C.disabled(l.value)||d.value)return;let V=t.calculateIndex(l.value);t.goToOption(z.Specific,V,0)}function P(b){var C;E.wasMoved(b)&&(l.disabled||(C=t.virtual.value)!=null&&C.disabled(l.value)||d.value&&(t.optionsPropsRef.value.hold||t.goToOption(z.Nothing)))}return()=>{let{disabled:b}=l,C={active:d.value,selected:f.value,disabled:b},V={id:a,ref:i,role:"option",tabIndex:b===!0?void 0:-1,"aria-disabled":b===!0?!0:void 0,"aria-selected":f.value,disabled:void 0,onMousedown:R,onFocus:M,onPointerenter:$,onMouseenter:$,onPointermove:F,onMousemove:F,onPointerleave:P,onMouseleave:P},v=oe(l,["order","value"]);return q({ourProps:V,theirProps:v,slot:C,attrs:e,slots:s,name:"ComboboxOption"})}}});export{Ye as d,fe as e,dt as i,ut as l,rt as n,vt as r,ct as u};
